# Project Prompt Instructions

## 基本規範
- 本倉庫專案皆為 **日系 2D 動漫** 製作，任何新檔案與流程請預設沿用動漫質感，並套用「動漫風格特別規範」中的漫畫感與 2D 層次限制。
- 所有 `prompt.md` 需直接在文件內完整貼上所引用的 `_core` 與 `_stylepacks` 模板內容，不得以連結、代碼或簡寫方式引用。
- 專案目錄內僅輸出 `prompt.md` 主檔；禁止生成 `meta.md` 或其他引用摘要檔案。
- 若需要新增重複使用的內容，請先確認是否已有對應模板，再決定是否撰寫新段落，並同樣完整內嵌於 `prompt.md`。
- 影片長度若未特別註明，預設為 **8 秒**，請在 Master Prompt 與分鏡區塊明確標記時間軸（建議 **4–6 幕 × 1.3–2.0s**）。
- 分鏡需維持 **Act → Beat → Angle** 的層級結構，並補齊運鏡、光影、聲音與轉場細節以利動畫工具解析。
- 專案請以「`<專案名稱>/<YYYY-MM-DD>_ep<集數>-<slug>`」的層級分類，建立 `prompt.md` 時務必放置於對應日期與集數資料夾內。
- 每份 `prompt.md` 正文至少 **420 行**，需確保所有模板內容與分鏡細節完整展開，不得因精簡而低於行數下限。
- **所有專案日期一律以 UTC+8（台灣時間）當下日期為準**：建立新專案時，需依當下 UTC+8 的日期決定檔名中的日期標記。
  - 例如：在 2025-11-14 10:23（UTC+8）為「異界編譯」系列撰寫第三集、slug 為 `curve-bolt-second-strike_v01` 的專案，其路徑應為：
    `異界編譯/2025-11-14_ep3-curve-bolt-second-strike_v01/prompt.md`

### Anime x PBR Priority Rules（2D 角色與 3D 特效並行時的衝突處理）

1. [最高優先] 畫面需被識別為「2D 日系動漫」：
   - 輪廓線、色塊分層、陰影階數、景深與運鏡都須服從動漫質感。
2. [次優先] 角色本體與關鍵表演元素一律以 **2D** 呈現：
   - 角色臉部、身體、服裝、招牌武器皆以 2D 線稿＋cel shading，3D 僅能作為底稿後再由 2D overpaint 回收。
3. [並行條件] 3D 特效（粒子、體積光、碎石、能量波等）可與 2D 角色同鏡存在：
   - 在 Act/Beat/Angle 的 `2D / 3D Layering` 中列出疊層關係，並強制標註「角色_base=2D」「FX=3D 粒子/VDB」。
4. PBR / 物理參數視為「內部渲染指引」，用來：
   - 定義光源方向、強度與材質反應，
   - 但最終呈現仍以 cel shading 與簡化層次輸出。
5. [衝突優先序] 當下列描述相互矛盾時，採用以下優先順序處理，並在 `## AGENT Self-Check` 內記錄調整：
   - 2D 動漫辨識度（輪廓線、色塊分層、2–6px 視差） >
   - 角色 2D 表演完整度（表情、肢體、服裝描邊） >
   - 3D FX 輔助層（僅限粒子/體積/大尺度環境，且需 toon-style 光影） >
   - PBR 細節（若導致寫實衝突則簡化或移除）。

## 2D Anime x 3D FX 統合規範

### 2D / 3D 角色分工

- [MUST] 角色本體與關鍵表演元素一律以 **2D Anime** 為主：
  - 角色輪廓線、面部五官與表情、主要肢體輪廓必須是 2D 線稿＋cel shading。
  - 角色貼身服裝、標誌性武器、招牌 Pose 不得以寫實 3D 模型主導。
- [MUST] 3D 僅用於下列「輔助層級」：
  - 粒子與體積特效：火花、雷電、碎石、煙霧、雨雪、能量波、魔法陣發光。
  - 大尺度環境：城市遠景、軌道、橋梁結構、地面碎裂、飛散殘骸。
  - 非表情向、機械感道具：重弩、巨斧、槍械、載具等，可用 3D 模型，但需以 2D 線條與 cel shading 回收邊緣質感。
- [MUST] 若 3D 模型直接參與角色近距離特寫（< 35mm 焦段＋胸像以上）：
  - 必須在分鏡中標註「2D overpaint 層級」與描邊粗細，確保最後視覺仍讀成 2D。

### 3D FX 質感處理（遵守 Anime x PBR Priority）

- [MUST] 所有 3D FX（體積光、爆炸、粒子）必須：
  - 使用 **cel shading / toon-style** 光照，限制陰影階數（1–2 階），避免寫實漸層。
  - 色彩優先匹配 `style_primary` / `style_secondary` 主題色，而非真實光譜。
- [SHOULD] 3D FX 的 PBR 參數僅作為「內部計算參考」：
  - 粒子粗糙度、金屬度、IOR 等可在 Master Prompt 內定義，但在畫面中以 2D 風格化輸出；
  - 如遇到與「反 3D 檢核」衝突，一律優先遵守 2D 動漫質感，並在 `## AGENT Self-Check` 中說明簡化處理。
- [MUST] FX 與角色的交互（光、影、遮擋）需以 2D 為主：
  - 例如雷電照亮角色臉部，最終仍以 2D 高光塊＋cel shading 表現，而非真實 ray traced 高光。

### Camera & Parallax 對 3D 的限制

- [MUST] 運鏡語言優先遵守「動漫風格特別規範」：
  - 以平移／推拉／上下移為主；禁止無必要的 360° 繞拍與 VR 式視差。
  - 若使用 3D 場景輔助運鏡，需限制視差與鏡頭路徑，使畫面仍讀作 2D Layout 延伸。
- [SHOULD] 對 3D 場景使用「camera projection / limited parallax」：
  - 在 `### Execution note` 中標註：哪些鏡頭採用投影貼圖＋輕微 parallax，而非真實 3D camera fly-through。
- [MUST] 當 3D 場景導致景深、散景過於寫實時：
  - 必須在分鏡中指定「bokeh 形狀簡化、對比度壓低」，避免看起來像實拍鏡頭模糊。

### 3D FX 在分鏡層級的標註方式

在每一個 Angle 的 `Materials & Physics` 欄位中，一律補上一行：

- `2D / 3D Layering:`  
  - 明確標出：`角色_base=2D`, `前景碎石=3D 粒子`, `後景體積光=3D VDB`, `2D 漫畫線條 overlay 在最上層`。
- `FX Solver & Budget:`  
  - 指定使用方式（如：`3D VDB`, `粒子系統`, `Flip fluid`）、粒子數大致級距（1e4 / 1e5）與預期運算成本（僅作為參考，不需精確）。

範例（Angle 裡的一段）：

- Materials & Physics:
  - 角色：2D cel shading，膚質 SSS 0.08，描邊 0.9px。
  - 武器：2D 線稿＋3D base 模型參考，粗糙度 0.35，金屬度 0.7。
  - 2D / 3D Layering：角色與武器輪廓=2D；地面裂縫碎石=3D 粒子；雷電殘光=3D 體積光，透明度 70%，上疊 2D 速度線。



### 精細度與展開原則
- 每段敘述以「**具體名詞 + 量化形容詞 + 物理行為 + 感官線索**」為句型基礎，避免單句內出現未定義的代稱或僅靠「高質感、漂亮」等空泛詞。
- 對於環境、角色、道具、光源、聲音、運鏡等關鍵元素，務必在首次出現時標註 2–3 個可測量或可觀察的指標（尺寸/重量/溫度/速度/頻率/亮度/色碼/粒度），之後再延伸描述變化。
- 每個 Act 至少加入 1 段 **micro-actions**（< 1.2s 的細部動作鏈），逐幀說明姿態、支撐點、反作用力與反饋，確保動畫工具可解析。
- 如使用修辭或隱喻，需立即在括號內補充可操作的視覺或聲音對應，不得讓執行者自行揣測。
- 當描述需要「同時發生」的事件，請以時間戳記或項目符號標示「T0、T0+0.3s、T0+0.6s」等節點，並點明鏡頭參數在每個節點的調整。

## 物理寫實與高級質感要求
- 任何 Act/Beat/Angle 的描述都必須標註對應的真實物理特徵（重力、慣性、摩擦、流體/布料/粒子反應），並指明鏡頭內的光學行為（折射、次表面散射、鏡面/粗糙反射）。
- 材質必寫 PBR 參數與微表面細節（粗糙度、金屬度、法線/置換、指紋與磨痕等使用痕跡），並交代光源色溫、能量分佈、環境遮蔽或體積霧對畫面的影響。
- 每幕需敘明高級質感的來源：如電影級光比、膚質分層（base color/SSS/specular）、高解析紋理、景深/畸變校正與顆粒控制，避免僅以「高品質」空泛描述。
- 以上物理與質感細節必須完整收錄在 `prompt.md` 的 Master Prompt 及各分鏡段落，不得省略或以「同前鏡」代稱。

### 深度質感層次寫法
- 針對材質，強制提供三層細節：**基底（Base Color/Albedo） → 次表面與微結構（SSS、微刮痕、指紋、油膜） → 表層干涉（鏡面/粗糙反射、菲涅耳、光暈/眩光控制）**，並說明各層對光線與陰影的影響。
- 若場景含有流體、霧、火花或粒子效果，需交代介質密度、散射與吸收係數、粒徑分佈、模擬求解方式（如 VDB/Flip/粒子數量上限）與運算預期成本。
- 對於角色膚質與布料，必須描述貼圖解析度、縫線/纖維走向、磨損區域與碰撞行為；若有風、雨、煙或灰塵干擾，列出力場方向、強度與持續時間。
- 碰撞或接觸場景需指出接觸面的摩擦係數、彈性係數與阻尼，並寫明衝擊後的能量分配或二次運動（衣物揚起、飄帶延遲、飄散方向）。

## 風格擴充流程
- 遇到全新製片風格需求時，於對應 `prompt.md` 的 `_stylepacks` 區塊新增一段 **新風格樣板**，以「`Style: <風格名稱>`」標題開頭，後接明確的視覺、敘事、攝影與聲音特徵描述。
- 新風格樣板須標註適用情境與不可混用的限制，並附上 1～2 個代表性元素，方便後續檢索與一致化運用。
- 若新風格可能重複使用，可於內部知識庫另行保存同名樣板全文，但在專案倉庫內仍僅保留 `prompt.md`，以維持檔案規範。

## 行為與介面強化
- 產出前必須要求且檢查輸入欄位：`project_name`、`series_name/arc`、`episode_index`、`slug`、`target_platform`、`duration_sec`（預設 8）、`style_primary`、`style_secondary`、`worldstate_ref`、`goal`。
- 輸出僅能是一份完整的 `prompt.md`，且必備 `_core`、`_stylepacks`、Master Prompt、Act/Beat/Angle 分鏡、Platform Layer 與 Self-Check 區塊。
- 若劇情、世界觀或角色資訊有不確定處，禁止自行補完，必須在 `### Assumptions` 中列出假設並標註理由，供人類審核。
- 每份 `prompt.md` 結尾強制加入「## AGENT Self-Check」，逐項回答：結構（Master/Act/Beat/Angle/timecode）、Physics & PBR（各幕重力/慣性與材質/光學）、Stylepacks 使用與衝突、Continuity（引用的上一集狀態機與 Persistent Elements）。
- 每次提交前，Self-Check 必須主動揭露不足或不確定的項目，不得空白。

### 進階欄位提示
- Master Prompt 必須列出：場景與角色的 **worldstate snapshot**、跨集或跨鏡的 **constraint list**（不可改變的姿態/道具位置/角色情緒曲線）、以及 **execution note**（建議採用的求解或合成方法，如 camera projection、volume pass、denoise 限制）。
- `_core` 與 `_stylepacks` 段落新增「**Do/Don't**」小節，清晰列出可用與禁用的鏡頭語言、調色手法、構圖忌諱，並在分鏡內實際引用（例如「遵循 Do: 對比度 1.8 gamma curve」）。
- `Platform Layer` 需補充「切片輸出策略」：短版/長版各需標註可直接截取的時間段與對應字幕行，避免重寫。
- `## Negative Instructions` 增列「自動檢核清單」，逐條確認是否出現禁用商標、侵權角色、政治宗教符號、血腥/成人尺度、錯誤語言環境或不合規字幕。

## 品質自檢清單（須全數達到 10/10）

1. **結構完整度**  
   Master Prompt 與分鏡層級是否齊全（含 `_core`、`_stylepacks`、Technical Specs、Acts/Beats/Angles、Platform Layer、Negative Instructions、Assumptions、Self-Check），時間軸與長度是否明確、一致。

2. **敘事一致性**  
   Act、Beat 與 Angle 描述是否連貫、節奏合理，並且符合對應 `_stylepacks` 與 worldstate 設定，不出現角色性格或世界觀自我矛盾。

3. **視聽細節**  
   攝影（鏡頭焦段、機位、運鏡）、光影（主光/輔光/背光）、聲音（環境音、特效音、台詞）、轉場（硬切、疊化、匹配剪接）是否具體、可操作，而非僅停留在抽象形容詞。

4. **風格準確性**  
   引用或新增之 `_stylepacks` 是否貼合需求、無衝突；各 Angle 是否實際遵守 Style 的 Do/Don't（例如構圖忌諱、對比度、色溫範圍）。

5. **格式精準度**  
   段落層級（Act → Beat → Angle）、標題命名、縮排與標點是否符合專案規範；檔名與路徑是否正確使用 `<專案名稱>/<YYYY-MM-DD>_ep<集數>-<slug>/prompt.md`。

6. **2D Anime Consistency vs 3D FX**  
   - 角色與關鍵動作是否全程以 2D 表現？有無誤用 3D 寫實陰影或過度寫實景深？  
     - 說明：__________________________________  
   - 3D FX 是否僅用於粒子 / 體積 / 大尺度環境，而非主體輪廓與臉部表演？  
     - 說明：__________________________________  
   - 是否有鏡頭接近寫實 3D 視覺（過度體積光、真實散景、過大視差）？若有，是否已在分鏡中給出 2D 化修正方案（如增加漫畫線條 overlay、降低景深寫實度等）？  
     - 說明：__________________________________

7. **物理質感到位**  
   各幕是否寫明重力/慣性、布料或流體/粒子反應、接觸面的摩擦與彈性、光學行為（折射、SSS、鏡面/粗糙反射等）與 PBR 材質參數，高級質感來源是否完整植入 Master Prompt 與分鏡，而非只用「高品質」帶過。

8. **量化標記度**  
   各 Act/Beat/Angle 是否具備量化指標（大小、速度、時間、亮度等）、時間節點（如 T0、T0+0.3s、T0+0.6s）與同步事件標註，是否避免模糊詞彙或未定義代稱。

9. **可交付性**  
   平台/字幕/切片輸出策略是否明確（Hook A/B、可截取時間段、對應字幕行、縮圖構圖）；`## Negative Instructions` 是否完整；Self-Check 是否具體揭露風險與待補資訊，而非空泛通過。


## Prompt 結構擴充
- 必備 `## Technical Specs`：統一列出 Aspect Ratio（9:16 直式）、FPS、180 度快門運動模糊、鏡頭組（24/35/50/75mm 用途註記）、景深與焦外、顆粒控制、色彩流程（log → filmic LUT → final contrast）、社群壓縮下的細節保留策略。
- 新增 `## Platform Layer`：hook line（0–1s）、first-shot visual hook、字幕/Caption 建議（短版/長版）、縮圖構圖、Hashtag 建議、CTA 需求；同一支影片需提供 Hook A（故事向）與 Hook B（迷因/衝擊向）。
- `_stylepacks` 內每個 Style 必須標註 Applicable for、Do NOT mix with、Default ON/OFF、Visual/Audio traits，避免風格衝突並清楚開關。
- 每個 Angle 強制含 5 欄位：Camera、Lighting、Materials & Physics（含重力/慣性與 PBR）、Emotion & Performance、Audio & Transition。禁止以「同前」代稱。
- 必備 `## Negative Instructions`：列出禁用內容（真實商標/名人/宗教政治符號等）、避免的畫面風格（過曝、廉價濾鏡、過度晃動/魚眼）、畫面尺度限制（PG-13 等）。
- 在 `_core` 加入品牌層：品牌角色共同特徵、場景色調與光感、文案語氣（中日英混用節奏），作為全系列 Brand Bible。

### 維護共享世界與角色模板
- 在 `_core` 段落中維護世界觀設定與角色檔案，統一角色口頭禪、動作習慣、服裝色票與關鍵道具描述。
- 若角色或場景有變動（例如造型、武器、場景破壞），需在模板中標註有效集數與變動原因，並更新後續集數的預設狀態。
- 每次撰寫新集劇本時，直接複製最新模板，避免漏掉關鍵屬性或沿用過時資訊。

### 攝影延續與轉場規劃

## 動漫風格特別規範（全倉庫預設啟用）
- 若 `{風格}` 含「動漫/Anime」，最高潮的 1–2 幕必須漫畫化：彩色漫畫分格或疊加，粗線稿＋網點/速度線、手繪擬聲字，並同步運鏡與音效節奏以強調擊殺/爆發/轉折的衝擊力。
- 漫畫化需與 PBR/光學敘述共存：標註網點厚度、描邊粗細（0.8–1.6px）、體積光/爆閃的散射與折射影響，避免因風格化而模糊物理細節。
- 2D 日系質感：每幕保持 3–4 層平面分層、2–6px 輕微視差；材質以色塊＋1–2 級漸層呈現，禁止厚重 3D 陰影或照片級置換；描邊依景深 0.6–1.2px，膚質以 cel shading base color＋SSS 0.05–0.12，避免玻璃/金屬鏡面反射感。
- 反 3D 檢核：背景禁重度體積光或景深散景；鏡頭運動以平移/推拉/上下移為主，避免 360° 繞拍或過大視差；粒子/特效可使用 3D 體積/VDB/粒子求解，但需在分鏡中標註求解方式、粒徑分佈、透明度（預設 60–85%）、速度（0.4–0.9m/s）與合成層級，確保 3D 質感與 2D cel shading 光感一致。
- 3D 元素僅允許作為「輔助 FX / 環境空間」層出現：
  - 角色與重要前景輪廓不得完全依賴 3D 實時光影；如有使用 3D base，需在 2D 上重新描邊與上色。
  - 若某鏡頭因 3D 運鏡或體積光而過於寫實，AGENT 必須在分鏡與 `## AGENT Self-Check` 中主動標註，並提供簡化方案（例如減少景深、降低體積光密度、增加 2D 漫畫線條 overlay）。
- 以上條目需在 Master Prompt 與高潮鏡頭中明確引用或點名，確保輸出保持日系動漫的一致性。
- 於 Master Prompt 中新增「Camera Continuity」子段落，明確記錄前一集結束時的鏡頭參數（焦距、機位、運鏡方向、光比）與延續需求。
- 對每個 Act 預先列出預計轉場（硬切、推拉、疊化、匹配剪接）與過渡鏡頭，確保跨集銜接時不產生突兀變化。
- 若須更換攝影語言，必須撰寫「轉換前置條件」，如劇情節點或視覺暗示，方便動畫師掌握節奏。


## AGENT Execution Flow

1. **抽取與補齊輸入欄位**
   - 從使用者輸入中擷取：`project_name`、`series_name/arc`、`episode_index`、`slug`、`target_platform`、`duration_sec`（預設 8）、`style_primary`、`style_secondary`、`worldstate_ref`、`goal`。
   - 若缺漏或矛盾：不得靜默補完，需在 `## Assumptions` 中明列「假設內容＋理由」。

2. **決定專案路徑與檔名**
   - 依照當下 UTC+8 日期生成 `<YYYY-MM-DD>_ep<集數>-<slug>`。
   - 在 `## AGENT Self-Check` 中紀錄實際決定的路徑字串，方便比對檔案系統。

3. **依固定順序產出完整 `prompt.md`**
   1. `_core`
   2. `_stylepacks`
   3. `## Technical Specs`
   4. `## Master Prompt`（含 Worldstate Snapshot / Constraint List / Execution Notes / Camera Continuity）
   5. `## Acts / Beats / Angles` 分鏡
   6. `## Platform Layer`
   7. `## Negative Instructions`
   8. `## Assumptions`
   9. `## AGENT Self-Check`

4. **逐項執行「品質自檢清單」**
   - 針對 1–9 點逐條回答，不得留白。
   - 特別標註：任何 3D FX 相關例外與「2D 化修正方案」必須在此重申一次。
